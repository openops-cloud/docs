# Add mermaid renderer to markdown (2025-10-06)

### New Features
- **Mermaid diagrams in Markdown**: Introduces a new `MermaidRenderer` component that lazy-loads Mermaid, renders theme-aware diagrams in code blocks, and provides a fullscreen expansion button. ([OPS-2777](https://linear.app/openops/issue/OPS-2777/add-mermaid-diagram-support-in-ai-chat))
- **Chat model switching API**: Added a new endpoint to update the language model in active chat sessions, with provider validation and context persistence.

### Security Improvement
- **SVG sanitization**: Mermaid SVG output is now passed through DOMPurify with a strict security level to prevent XSS vulnerabilities.

### Improvements
- **Diagram layout**: Mermaid diagrams now occupy full width with height constraints and show a loading state message.
- **Error handling & i18n**: Suppressed raw error output in the renderer and added an internationalized "Rendering diagram..." message.

### Refactor
- **Code rendering components**: Split the Markdown code renderer into separate components for streaming code, Mermaid diagrams, and standard code blocks for better maintainability.

### Miscellaneous
- Added the Mermaid library to dependencies.
- Updated third-party license documentation.
