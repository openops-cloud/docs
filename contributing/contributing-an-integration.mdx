---
title: 'Contributing an Integration'
description: 'Developing a fully working OpenOps block to integrate with a third party service'
icon: 'code'
---

[Contributing a minimal block](/contributing/contributing-a-minimal-block/) demonstrated how to use scaffolding and make a block show up in the OpenOps UI. Let's now see how you would create a fully functional integration with a third-party service.

OpenOps integrates with Jira Cloud and Linear, but what if you use a different service for tracking your cloud optimization opportunities? Let's see how you would create a block that integrates with [JetBrains YouTrack](https://www.jetbrains.com/youtrack/). This involves implementing API key based authentication and designing a couple actions that interact with the [YouTrack API](https://www.jetbrains.com/help/youtrack/devportal/youtrack-rest-api.html).

This is not a step-by-step guide. Instead, it's an overview that highlights prominent parts of the process.

## Scaffolding a new block

To scaffold a new block, you run the following command:

```bash
npm run cli blocks create
```

For a YouTrack integration, you would supply the following information to the CLI:

1. `Block name`: "youtrack" (lowercase).
2. `Package name`: leave blank to use the default name.
3. `Authentication type`: select `Custom (Custom properties)`.
4. `Create opinionated folder structure with stubs for actions, tests, and common service layer`: select `Yes - Create full folder structure with stubs`.

OpenOps generates a full project template inside `packages/blocks/youtrack/`, including `package.json`, TypeScript configuration files, ESLint and Jest configuration files, an entry point for the block at `src/index.ts` and a starter test file at `test/index.test.ts`.

Let's take a closer look at the generated files.

### src/index.ts

`src/index.ts`  is the entry point to the new block. It uses the `createBlock()` function from the OpenOps block framework to create a new block. This function takes a number of arguments, of which the most important ones are:
* `auth`: authentication implementation for the block. It defines which credentials the user needs to specify in your block's [connection](/cloud-access/access-levels-permissions) properties to authenticate with the API that the block integrates with.
* `actions`: an array that contains the actions that the block exposes. The scaffolded version includes a predefined action that allows making a custom API call to the block's API.

```ts
import { createCustomApiCallAction } from '@openops/blocks-common';
import { createBlock, Property } from '@openops/blocks-framework';
import { BlockCategory } from '@openops/shared';
import { youtrackAuth } from './lib/auth';

export const youtrack = createBlock({
  displayName: 'Youtrack',
  auth: youtrackAuth,
  minimumSupportedRelease: '0.20.0',
  logoUrl: 'https://static.openops.com/blocks/youtrack.png',
  authors: [],
  categories: [BlockCategory.FINOPS],
  actions: [
    createCustomApiCallAction({
      baseUrl: () => 'https://api.youtrack.com',
      auth: youtrackAuth,
      additionalProps: {
        documentation: Property.MarkDown({
          value:
            'For more information, visit the [Youtrack API documentation](https://docs.youtrack.com/reference/introduction).',
        }),
      },
    }),
  ],
  triggers: [],
});
```

### src/lib/auth.ts

Scaffolding generates a placeholder authentication implementation in a separate file. It uses a `CustomAuth()` helper function from the OpenOps block framework. The function takes several parameters, of which the most important ones are:
* `props`: an object that defines the inputs necessary to authenticate with the service provider that the block integrates with.
* `validate`: a function for optional validation of the inputs provided in `props`.

```ts
import { BlockAuth, Property } from '@openops/blocks-framework';

export const youtrackAuth = BlockAuth.CustomAuth({
  authProviderKey: 'youtrack',
  authProviderDisplayName: 'Youtrack',
  authProviderLogoUrl: 'https://static.openops.com/blocks/youtrack.png',
  description: 'Configure your Youtrack connection',
  required: true,
  props: {
    apiKey: Property.SecretText({
      displayName: 'API Key',
      required: true,
    }),
    baseUrl: Property.ShortText({
      displayName: 'Base URL',
      description: 'The base URL for Youtrack API',
      required: true,
    }),
  },
  validate: async ({ auth }) => {
    // Add validation logic here
    return { valid: true };
  },
});
```

### Project files

OpenOps uses [Nx](https://nx.dev/) as its build system, and `project.json` is the Nx project file that defines how the new block is built, tested, and linted in an Nx workspace. It sets the source root, output path, TypeScript config, package entry points, and assets, and declares executors for build (`@nx/js:tsc`), test (`@nx/jest:jest`), and lint (`@nx/eslint:lint`).

```json
{
  "name": "blocks-youtrack",
  "$schema": "../../../node_modules/nx/schemas/project-schema.json",
  "sourceRoot": "packages/blocks/youtrack/src",
  "projectType": "library",
  "tags": [],
  "targets": {
    "build": {
      "executor": "@nx/js:tsc",
      "outputs": ["{options.outputPath}"],
      "options": {
        "outputPath": "dist/packages/blocks/youtrack",
        "tsConfig": "packages/blocks/youtrack/tsconfig.lib.json",
        "packageJson": "packages/blocks/youtrack/package.json",
        "main": "packages/blocks/youtrack/src/index.ts",
        "assets": ["packages/blocks/youtrack/*.md"],
        "buildableProjectDepsInPackageJsonType": "dependencies",
        "updateBuildableProjectDepsInPackageJson": true
      }
    },
    "test": {
      "executor": "@nx/jest:jest",
      "outputs": ["{workspaceRoot}/coverage/{projectRoot}"],
      "options": {
        "jestConfig": "packages/blocks/youtrack/jest.config.ts"
      }
    },
    "lint": {
      "executor": "@nx/eslint:lint",
      "outputs": ["{options.outputFile}"]
    }
  }
}
```

`package.json` is a minimal metadata file declaring the block's name and version within the Nx workspace. Unlike typical npm packages and as opposed to the Activepieces extension practices, this file isn't meant for publication to the npm registry. Instead, it mainly helps Nx identify the project and marks the block as a versioned unit inside the larger repository.

```json
{
  "name": "@openops/block-youtrack",
  "version": "0.0.1"
}
```

### Test files

`test/index.test.ts` is a stub Jest test fixture that includes a few sample tests for the block. Tests in this fixture can be executed by running `nx test blocks-youtrack`.

```ts
import { youtrack } from '../src/index';

describe('block declaration tests', () => {
  test('should return block with correct authentication', () => {
    expect(youtrack.auth).toMatchObject({
      type: 'CUSTOM_AUTH',
      required: true,
      authProviderKey: 'youtrack',
      authProviderDisplayName: 'Youtrack',
      authProviderLogoUrl: 'https://static.openops.com/blocks/youtrack.png',
    });
  });

  test('should return block with correct number of actions', () => {
    expect(Object.keys(youtrack.actions()).length).toBe(1);
    expect(youtrack.actions()).toMatchObject({
      custom_api_call: {
        name: 'custom_api_call',
        requireAuth: true,
      },
    });
  });
});
```

There's also a Jest configuration file, `jest.config.ts`, that inherits shared settings from OpenOps' Jest preset, references a TypeScript config file, defines recognized file extensions and specifies where to store code coverage reports:

```ts
export default {
  displayName: 'blocks-youtrack',
  preset: '../../../jest.preset.js',
  setupFiles: ['../../../jest.env.js'],
  testEnvironment: 'node',
  transform: {
    '^.+\\.[tj]s$': ['ts-jest', { tsconfig: '<rootDir>/tsconfig.spec.json' }],
  },
  moduleFileExtensions: ['ts', 'js', 'html'],
  coverageDirectory: '../../../coverage/packages/blocks/youtrack',
};
```

### TypeScript configuration files

Scaffolding generates three TypeScript configuration files: `tsconfig.json`, `tsconfig.lib.json`, and `tsconfig.spec.json`

`tsconfig.json` is the base config for the block. It extends the workspace's root `tsconfig.base.json` and enforces strict compiler options but doesn't include any source files directly. Instead, it references the other two config files, serving as an entry point for both:

```json
{
  "extends": "../../../tsconfig.base.json",
  "compilerOptions": {
    "module": "commonjs",
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "noImplicitOverride": true,
    "noPropertyAccessFromIndexSignature": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true
  },
  "files": [],
  "include": [],
  "references": [
    {
      "path": "./tsconfig.lib.json"
    },
    {
      "path": "./tsconfig.spec.json"
    }
  ]
}
```

`tsconfig.lib.json` applies to the block's source code. It outputs compiled files to `dist/out-tsc`, generates type declarations, and includes only non-test TypeScript files under `src/`:

```json
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "module": "commonjs",
    "outDir": "../../../dist/out-tsc",
    "declaration": true,
    "types": ["node"]
  },
  "exclude": ["jest.config.ts", "src/**/*.spec.ts", "src/**/*.test.ts"],
  "include": ["src/**/*.ts"]
}
```

`tsconfig.spec.json` is tailored for testing. It includes test and declaration files and sets up Jest typings:

```json
{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": "../../../dist/out-tsc",
    "module": "commonjs",
    "types": ["jest", "node"]
  },
  "include": [
    "jest.config.ts",
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.d.ts"
  ]
}
```

### Other files

`.eslintrc.json` defines JavaScript and TypeScript linting behavior for the block, extending the OpenOps repository's root ESLint configuration. The `overrides` section provides placeholders for block-specific linting rules in case you feel like introducing them.

`README.md` stubs out documentation for the block.

## Post-scaffolding cleanup

OpenOps may alter the spelling of your block's display name when running scaffolding, so you may want to review this and run search and replace if needed. With YouTrack, it didn't use the proper casing for the product name, using "Youtrack" instead of "YouTrack".

Note that OpenOps also generates a stub logo URL at the static.openops.com domain, which doesn't exist. To see your product's logo in the OpenOps UI during development, consider replacing the stub logo URL with a URL on a server that you control. For example, for YouTrack, the https://static.openops.com/blocks/youtrack.png stub URL can be replaced with a [live YouTrack logo URL](https://resources.jetbrains.com/storage/products/company/brand/logos/YouTrack_icon.png). Alternatively, you can keep the stub as is and ask OpenOps to upload your logo when you open a PR.

Even this basic scaffolding introduces the new block to the OpenOps UI, even though the block doesn't do much yet. Here's what you can see at this point if you run `npm run start` and open the OpenOps frontend at http://localhost:4200/ in your browser:

![The scaffolded block in OpenOps UI](/images/contributing/youtrack-in-the-ui.png)

## Implementing authentication (and getting a connection for free)

Now that you have a block, you could get right to building its actions. However, unless your block interacts with a publicly accessible API, you need to provide the user with a way to authenticate with the API that your block is built upon. How you implement authentication defines what the user will see when they try to create a new [connection](/cloud-access/access-levels-permissions) for your block.

Scaffolding generated a placeholder authentication implementation and referenced it from the YouTrack block's entry point. What's left to do is implement the actual authentication logic in the `src/lib/auth.ts` file. As a reminder, here's what the scaffolded file initially looked like:

```ts
import { BlockAuth, Property } from '@openops/blocks-framework';

export const youtrackAuth = BlockAuth.CustomAuth({
  authProviderKey: 'youtrack',
  authProviderDisplayName: 'Youtrack',
  authProviderLogoUrl: 'https://static.openops.com/blocks/youtrack.png',
  description: 'Configure your Youtrack connection',
  required: true,
  props: {
    apiKey: Property.SecretText({
      displayName: 'API Key',
      required: true,
    }),
    baseUrl: Property.ShortText({
      displayName: 'Base URL',
      description: 'The base URL for Youtrack API',
      required: true,
    }),
  },
  validate: async ({ auth }) => {
    // Add validation logic here
    return { valid: true };
  },
});
```

As you can see, this block uses a `CustomAuth()` helper function to define YouTrack authentication. There are other [types of authentication](/contributing/authentication/), but `CustomAuth()` works best for YouTrack because apart from an API key, the user needs to specify a base URL as YouTrack can be cloud-hosted by JetBrains, with a base URL different for each cloud instance, or self-hosted by customers.

The values of `authProviderKey`, `authProviderDisplayName`, `authProviderLogoUrl` and `required` properties are just fine as they are. What needs to be changed are the values of `props`, `validate`, and `description`. Let's start with `props`.

### Defining connection properties

`props` defines the inputs necessary to authenticate with the service provider that the block integrates with. Each of these inputs is an OpenOps UI component that can be a regular or a masked input field, a checkbox, a dropdown, and more. To learn more about the component library, see [Activepieces documentation](https://www.activepieces.com/docs/developers/piece-reference/properties). This component library is not only used in defining connections, but also in actions that a block exposes.

The first property, `apiKey`, is for the user to provide a YouTrack API key a.k.a. a permanent token. The scaffolded version of this property uses a `SecretText` property type, which is a masked input field, and it's just what we need to this kind of data. Let's expand the scaffolded version of the property to include a description:

```ts
apiKey: Property.SecretText({
  required: true,
  displayName: 'API key',
  description:
    'The API key (permanent token) for your YouTrack installation.',
})
````

The second property, `apiUrl`, is for the user to provide a base URL for their YouTrack instance. This property is a regular input field. The scaffolded version is a good start, but we can improve it by adding a better description, providing a default value, and using a predefined validation rule for URLs:

```ts
apiUrl: Property.ShortText({
  displayName: 'Base URL',
  description:
    'The base URL of your YouTrack installation without a trailing slash.',
  required: true,
  validators: [Validators.url],
  defaultValue: 'https://your-instance.myjetbrains.com/youtrack',
})
```

Note that for this to compile, we need to extend the import from the `@openops/blocks-framework` package to include the `Validators` object:

```ts
import { BlockAuth, Property, Validators } from '@openops/blocks-framework';
```

`Validators.url` is not the only predefined validation rule. OpenOps provides an array of ready-to-use validation rules for value ranges, dates, emails, phone numbers, image formats, and more.

### Adding custom validation

Adding predefined validation rules to properties is one way of enforcing a certain format or pattern for user input. You can also add custom validation rules using the `validate()` function.

Some blocks, such as [Linear](https://github.com/openops-cloud/openops/blob/7fad45c16a0ab4a01eaa5a2b9b50d304effc9f83/packages/blocks/linear/src/index.ts#L29C1-L39C5), use `validate()` to make sure that the API key confirms to a specific format. With YouTrack, there's no need to do this. Instead, it's reasonable to check that the base URL doesn't have a trailing slash as YouTrack doesn't normalize URLs with double slashes. Here's how this could be done:

```ts
validate: async ({ auth }) => {
  if (auth.apiUrl.endsWith('/')) {
    return {
      valid: false,
      error: 'Base URL must not end with a slash',
    };
  } else {
    return { valid: true };
  }
}
```

The `auth` object passed to `validate()` contains the values of all the properties that the user has provided. This lets you introduce any additional checks on `auth.apiUrl`, which holds the entered base URL value.

You could also use `validate()` to try to authenticate the user with a given API key. For example, the
[ServiceNow](https://github.com/openops-cloud/openops/blob/7fad45c16a0ab4a01eaa5a2b9b50d304effc9f83/packages/blocks/servicenow/src/lib/auth.ts#L34C1-L54C5) and [Umbrella](https://github.com/openops-cloud/openops/blob/7fad45c16a0ab4a01eaa5a2b9b50d304effc9f83/packages/blocks/anodot/src/lib/anodot-auth-property.ts#L37C1-L64C5) blocks make sample requests to their APIs to tell the user right away if authentication fails.

### Adding a Markdown description

When a user sets up a connection, they don't necessarily know right away how to obtain an API key or a different value that they're expected to enter during connection setup.

To guide them, use the `description` property. The best part about this property is that it's not limited to plain text; instead, you can provide a Markdown-formatted string, and OpenOps will render it in the connection UI, between the title and the first input.

For YouTrack, a Markdown description could look like this:

```ts
const markdown = `
To get your YouTrack API key:
1. Go to your YouTrack installation.
2. In the navigation menu, click your user profile icon, then click **Profile**.
3. Open the **Account Security** tab.
4. Under **Tokens**, click **New token**.
5. Give the new token a name and select **YouTrack** in the list of scopes.
6. Click **Create**.
7. Copy the token to your clipboard.`;
```

When providing a description as a separate variable as shown here, remember to assign the variable to the `description` property:

```ts
description: markdown
```

### Adding an interface

### The resulting authentication code and connection UI

The result:

```ts
import { BlockAuth, Property, Validators } from '@openops/blocks-framework';

const markdown = `
To get your YouTrack API key:
1. Go to your YouTrack installation.
2. In the navigation menu, click your user profile icon, then click **Profile**.
3. Open the **Account Security** tab.
4. Under **Tokens**, click **New token**.
5. Give the new token a name and select **YouTrack** in the list of scopes.
6. Click **Create**.
7. Copy the token to your clipboard.`;

export const youtrackAuth = BlockAuth.CustomAuth({
  required: true,
  authProviderKey: 'youtrack',
  authProviderDisplayName: 'YouTrack',
  authProviderLogoUrl:
    'https://resources.jetbrains.com/storage/products/company/brand/logos/YouTrack_icon.png',
  description: markdown,
  props: {
    apiKey: Property.SecretText({
      required: true,
      displayName: 'API key',
      description:
        'The API key (permanent token) for your YouTrack installation.',
    }),
    apiUrl: Property.ShortText({
      displayName: 'Base URL',
      description:
        'The base URL of your YouTrack installation without a trailing slash.',
      required: true,
      validators: [Validators.url],
      defaultValue: 'https://your-instance.myjetbrains.com/youtrack',
    }),
  },
  validate: async ({ auth }) => {
    if (auth.apiUrl.endsWith('/')) {
      return {
        valid: false,
        error: 'Base URL must not end with a slash',
      };
    } else {
      return { valid: true };
    }
  },
});

export interface YouTrackAuth {
  apiUrl: string;
  apiKey: string;
}
```


![A YouTrack connection type in OpenOps UI](/images/contributing/youtrack-connection-type.png)

TODO img connection dialog

TODO img connection dialog with error

## Adding a simple action

Remove scaffolded action

Demonstrate /packages/blocks/youtrack/src/lib/actions/get-all-issues.ts

Add the action to block definition

Show result in OpenOps UI

## Adding an action with properties

Demonstrate /packages/blocks/youtrack/src/lib/actions/change-issue-status.ts

Add the action to block definition

Show result in OpenOps UI
