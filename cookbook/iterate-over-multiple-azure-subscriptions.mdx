---
title: 'Iterating Over Multiple Azure Subscriptions'
description: 'How to build a workflow that performs actions across multiple Microsoft Azure subscriptions'
icon: 'repeat'
---

You can build workflows that retrieve the list of available Azure subscriptions and iterate over them.

Here's how to do it.

## 1. Create an Azure connection that enables access to multiple subscriptions

First, create an [Azure connection](/cloud-access/access-levels-permissions#azure-connections) if you don't already have one.

Unlike AWS connections, OpenOps doesn't provide a built-in way to enable access to multiple Azure subscriptions from connection settings.

Instead, you can use a single Azure **service principal** (application) to access multiple subscriptions by assigning it roles in each of them.

To do this:
1. In your Azure Active Directory tenant, create an app registration and a corresponding service principal.
2. Generate a client secret for the service principal. Use the service principal's **Application (client) ID**, **Client secret**, and **Directory (tenant) ID** to create an OpenOps connection.
3. In the Azure Portal or CLI, assign the same service principal appropriate IAM roles (for example, *Reader* or *Contributor*) in each subscription that you want OpenOps to access.

Once the service principal has access to multiple subscriptions, an OpenOps connection configured with its credentials can perform actions in any of those subscriptions.

## 2. Get the list of subscriptions

In your workflow, add an **Azure CLI** action.

In the action's properties, select the connection that enables access to multiple subscriptions.

Select any subscription in the **Subscriptions** dropdown.

In the **Command** field, enter the following:

```shell
az account list --output json
```

![An Azure CLI action to get the list of subscriptions](/images/cookbook/azure-list-subscriptions-properties.png)

When you test this action, it returns an array of objects, each containing the subscription ID and other metadata:

```json
[
  {
    "cloudName": "AzureCloud",
    "homeTenantId": "536df0a4-c5d9-4a38-adfa-3a81dcc81a33",
    "id": "85ec64cc-2107-4774-a848-87a92543bacd",
    "isDefault": true,
    "managedByTenants": [],
    "name": "Microsoft Azure Sponsorship",
    "state": "Enabled",
    "tenantId": "536df0a4-c5d9-4a38-adfa-3a81dcc81a33",
    "user": {
      "name": "2008127b-13d0-41e4-ad41-d8f2b2de6c92",
      "type": "servicePrincipal"
    }
  },
  {
    "cloudName": "AzureCloud",
    "homeTenantId": "536df0a4-c5d9-4a38-adfa-3a81dcc81a33",
    "id": "2c4a9e11-7f21-4e5a-bdfb-83e4c3a951d0",
    "isDefault": false,
    "managedByTenants": [],
    "name": "Development Sandbox",
    "state": "Enabled",
    "tenantId": "536df0a4-c5d9-4a38-adfa-3a81dcc81a33",
    "user": {
      "name": "2008127b-13d0-41e4-ad41-d8f2b2de6c92",
      "type": "servicePrincipal"
    }
  }
]
```

