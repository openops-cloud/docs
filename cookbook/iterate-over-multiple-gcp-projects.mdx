---
title: 'Iterating Over Multiple GCP Projects'
description: 'How to configure build a workflow to work with multiple Google Cloud Platform projects'
icon: 'repeat'
---

You can build workflows that retrieve the list of your GCP projects and iterate over them.

Here's how you could do this.

## 1. Create a Google Cloud connection that enables access to multiple accounts

First, create a [Google Cloud connection](/cloud-access/access-levels-permissions#google-cloud-connections) if you don't already have one.

Unlike AWS connections, OpenOps doesn't provide a built-in way to enable access to multiple Google Cloud projects from connection settings.

How you enable multi-project access depends on the type of connection you use.

If your connection uses a **service account JSON key**:
1. Create a service account in one of your Google Cloud projects.
2. Create an OpenOps connection using that service account.
3. In each additional project that you want OpenOps to access, grant the same service account appropriate IAM roles (for example, *Viewer* or *Editor*) in that project's IAM settings.

If your connection uses **local Google Cloud CLI credentials**, OpenOps will use the same identity as your local `gcloud` session (the user or service account you are logged in as). Multi-project access works automatically if that identity already has IAM roles in multiple projects. If not, grant the same user or service account the necessary roles in each target project's IAM settings.

## 2. Get the list of accounts

In your workflow, add a **Google Cloud CLI** action.

In the action's properties, select the connection that enables access to multiple projects. Select any project in the **Default Project** dropdown. In the **Command** field, enter the following:

```shell
gcloud projects list --format=json
```

![A GCP CLI action to get the list of projects](/images/cookbook/gcp-list-projects-properties.png)

When you test this action, you'll see that it returns an array of objects where each object contains the project ID and other metadata:

```json
[
  {
    "createTime": "2023-01-29T11:04:39.918Z",
    "lifecycleState": "ACTIVE",
    "name": "Unmeet",
    "projectId": "unmeet-476981",
    "projectNumber": "8310764926267"
  },
  {
    "createTime": "2022-05-26T16:42:52.982Z",
    "lifecycleState": "ACTIVE",
    "name": "BigQuery",
    "projectId": "bigquery-451001",
    "projectNumber": "456972339442"
  }
]
```
